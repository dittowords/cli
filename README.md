# Ditto CLI

The Ditto CLI helps teams integrate [Ditto](https://dittowords.com/) into their development workflows and build processes.

## Getting Started

You can install the CLI from npm:

```bash
# as a dev dependency (**recommended**)
npm install --save-dev @dittowords/cli
****
# as a global package
npm install --global @dittowords/cli
```

The installed binary is named `ditto-cli`. You can execute it directly in `node_modules/.bin/ditto-cli` or using [npx](https://www.npmjs.com/package/npx) (with or without installation) like `npx @dittowords/cli`.

The first time you run the CLI, you'll be asked to provide an API key (found at [https://app.dittowords.com/account/user](https://app.dittowords.com/account/user) under **API Keys**):

```
$ npx @dittowords/cli

┌──────────────────────────────────┐
│                                  │
│   Welcome to the Ditto CLI.      │
│                                  │
│   We're glad to have you here.   │
│                                  │
└──────────────────────────────────┘

What is your API key? > xxx-xxx-xxx

Thanks for authenticating.
We'll save the key to: /Users/{username}/.config/ditto
```

Once you've successfully authenticated, you'll be asked to choose a source (a project or your component library) to pull data **from**:

```
Looks like there are no Ditto sources selected for your current directory: /Users/ditto
****
? Choose the source you'd like to sync text from:
- Ditto Component Library https://app.dittowords.com/components
- NUX Onboarding Flow https://app.dittowords.com/doc/609e9981c313f8018d0c346a
...
```

After selecting a source, a configuration file will automatically be created at the path `./ditto/config.yml` relative to your current working directory. The CLI will attempt to read from this file every time a command is executed. See the [config.yml documentation](#files) further down in this README for a full reference of how the CLI can be configured.

Once you've successfully authenticated and a config file has been created, you’re ready to start fetching copy! If you need to use the CLI with multiple configurations, simply run `ditto-cli` in multiple directories.

## API Keys

The CLI will not prompt for an API key if a value is provided in the environment variable `DITTO_API_KEY`.

If the `DITTO_API_KEY` environment variable is not set, the CLI will attempt to parse a token from [your authentication file](#authentication). If this file does not exist or does not contain a valid API key, the CLI will prompt for one.

We don't recommend editing the authentication file by hand; if you need to remove a saved API key or swap one key with another, it's better to fully delete the file and then re-run the CLI.

## Commands

### Pull

**Usage:** `ditto-cli` (no commands), `ditto-cli pull`

**Action:** Pulls data from Ditto according to configured sources.

Generate files your local `ditto/` folder (file extension is determined by the `format` property specified in `config.yml`).

If no format is specified, the `flat` format will be used by default. Each time text is pulled from Ditto, the existing files in the `ditto/` directory are removed before new files are created in their place.

For more details on files generated by this command, see [Output Files](#output-files).

### Add project

**Usage:** `ditto-cli project add`

**Action:** Lists projects in your workspace that have developer mode enabled and permits selecting one to add to `config.yml` via an interactive prompt.

### Remove project

**Usage:** `ditto-cli project remove`

**Action:** Lists projects in `config.yml` and permits selecting one to remove from `config.yml` via an interactive prompt.

### Component folders

**Usage:** `ditto-cli component-folders`

**Action:** List component folders in your workspace. More information about component folders can be found here: https://www.dittowords.com/docs/component-folders.

## Configuration

The `config.yml` file is the source of truth for a given directory about how the CLI should fetch and store data from Ditto. It includes information about which Ditto projects the CLI should pull text from, whether or not the component library should be included, in what format the text should be stored, and more.

This file is edited by the `project add` / `project remove` commands, but most options are currently only supported through manual edits.

This is the default configuration file that is generated the first time that the CLI is run in a given directory:

```yml
sources:
  components:
    enabled: true
format: flat
variants: true
```

### Supported Properties

#### Sources

A list of places the CLI should pull text data from. For the CLI to function, at least one source type (`projects` or `components`) is required.

#### `sources.projects`

A list of projects to pull text from.

```yml
sources:
  projects:
    - id: 61b8d26105f8f400e97fdd14
      name: Landing Page Copy
    - id: 606cb89ac55041013d552f8b
      name: User Settings
```

The `name` property is used for display purposes when referencing a project in the CLI, but does not have to be an exact match with the project name in Ditto.

#### `sources.components`

An object to configure pulling component data from your component library.

```yml
sources:
  components:
    # type: boolean
    # required: true
    #
    # if set to true, enables pulling data from the component
    # library. if set to false, CLI behaves as if `sources.components`
    # is not defined
    enabled: true

    # type: { id: string; name: string; }
    # required: false
    #
    # if defined, restricts the CLI to only pulling data for components that are in the specified folders.
    folders:
      - id: 61b8d26105f8f400e97fdd14
        name: Onboarding
```

#### Variants

Enables including variant information when pulling text data for configured sources.

Defaults to `false` if not specified.

```yml
variants: true
```

##### Format

The format that text data should be generated in. Accepted values:

- `structured`
  \*\*\*\*- `flat`
- `android`
- `ios-strings`
- `ios-stringsdict` (will only include text that has pluralization enabled in Ditto)

Defaults to `flat` if not specified.

```yml
format: flat
```

#### Status

If defined, data pulled will be restricted to text items or components that have the specified status. Accepted values:

- `NONE`
- `WIP`
- `REVIEW`
- `FINAL`

```yml
status: FINAL
```

Defaults to no status restriction if not specified.

More information about statuses can be found [here](https://www.dittowords.com/docs/tips-for-collaborating).

#### Rich Text

If defined in conjunction with the `structured` format, output data will include an HTML string (rich text) for each text item or component that is sourced. You can read more about Ditto's rich text feature [here](https://www.dittowords.com/docs/rich-text).

```yml
richText: true
```

### Full Configuration Example

```yml
sources:
  components:
    enabled: true
    folders:
      - id: 61b8d26105f8f400e97fdd14
        name: Onboarding
  projects:
    - name: Landing Page Copy
      id: 61b8d26105f8f400e97fdd14
    - name: User Settings
      id: 606cb89ac55041013d552f8b
variants: true
format: flat
status: FINAL
richText: false
```

## CLI Files

### `ditto/` Directory

This directory houses the configuration file (`ditto/config.yml`) used by the CLI and is also the default write destination for any files the CLI generates. See [Output Directory](#output-directory) for details on how to customize the location that files are written to.

If you run the CLI in a directory that does not contain a `ditto/` folder, the folder and a default `config.yml` file will be automatically created.

#### Output Files

The CLI outputs data from Ditto by writing files to disk in your `ditto/` directory. The format and extension of such files will correspond to the `format` property of your configuration.

|   **Format**    | **File Extension** |  **Common Usage**   |
| :-------------: | :----------------: | :-----------------: |
|      flat       |       .json        |      Web apps       |
|   structured    |       .json        |      Web apps       |
|       icu       |       .json        |      Web apps       |
|     android     |        .xml        | Native Android apps |
|   ios-strings   |      .strings      |   Native iOS apps   |
| ios-stringsdict |    .stringsdict    |   Native iOS apps   |

All files created will adhere to the following template:

```
{source_name}__{variant_name}.{extension}
```

- `source_name`: the name of a project or `ditto_component_library` for files containing component data
- `variant_name`: the ID of a variant or `base` for files generated for non-variant text
- `extension`: the file extension that corresponds to your configured format

To help with keeping cross-platform behavior consistent, file names will be fully lowercase, have whitespace replaced with hyphens, and have non-word characters (with the exception of `-` and `_`) removed.

If the configured format results in JSON files being generated, an `index.js` "driver file" is also created to simplify the process of integrating Ditto into web apps:

```js
module.exports = {
  ditto_component_library: {
    base: require("./ditto_component_library__base.json"),
    spanish: require("./ditto_component_library__spanish.json"),
  },
  project_xxx: {
    base: require("./example-project__base.json"),
    spanish: require("./example-project__spanish.json"),
  },
};
```

The driver file is currently generated as a CommonJS module, but it's possible that ESM will be supported in the future.

## Authentication

By default, your API key is saved to `$HOME/.config/ditto`; the default path can be overwritten by specifying a custom one via the environment variable `DITTO_CONFIG_FILE`.

To change your API key, delete this file and you'll be prompted for a new key the next time that the CLI executes.

## SDKs

Our SDKs make it easy to integrate the copy pulled from the Ditto CLI into your applications.

- [Ditto React](https://www.npmjs.com/package/ditto-react) - easily integrate Ditto into your React project; includes support for localization using variants.

## Feedback

Have feedback? We’d love to hear it! Message us at [support@dittowords.com](mailto:support@dittowords.com).
